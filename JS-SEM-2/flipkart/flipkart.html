<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fakestore</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        nav.items a {
            padding: 8px 12px;
            color: white;
            text-decoration: none;
            text-transform: uppercase;
            font-size: 14px;
        }

        .two {
            position: absolute;
            top: -8px;
            right: -8px;
            background: red;
            color: white;
            border-radius: 50%;
            text-align: center;
            padding: 4px 7px;
            font-size: 12px;
            font-weight: bold;
        }

        header {
            height: 60px;
            flex-shrink: 0;
            /* Prevent header from shrinking */
        }

        .card-title {
            font-size: 14px;
            height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cart-item-img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        /* New styles for the two-column layout */
        .main-container {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
            /* Prevent scrolling on the body */
        }

        .sidebar {
            width: 280px;
            /* Fixed width for the sidebar */
            flex-shrink: 0;
            background-color: #f8f9fa;
            padding: 20px;
            overflow-y: auto;
            /* Allow sidebar to scroll if content overflows */
            border-right: 1px solid #dee2e6;
        }

        .content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            /* Allow main content to scroll */
        }

        /* Style for the cart table */
        #cartTable th,
        #cartTable td {
            vertical-align: middle;
            text-align: center;
        }
        #cartTable .product-info {
            text-align: left;
        }
    </style>
</head>

<body class="bg-light">

    <header class="d-flex justify-content-between align-items-center px-3 bg-dark text-white shadow-sm">
        <div class="ps-2">
            <h4>Fakestore</h4>
        </div>

        <nav id="navLinksContainer" class="d-flex items">
            <a href="#">HOME</a>
        </nav>

        <div class="me-2 cart-container position-relative">
            <button id="cartButton" class="btn btn-warning atc" data-bs-toggle="modal" data-bs-target="#cartModal">
                <i class="bi-cart3"></i>
                <span class="d-none d-md-inline">Cart</span>
            </button>
            <span id="cartBadge" class="bg-danger badge two">0</span>
        </div>
    </header>

    <div class="bg-black text-white py-1">
        <marquee>
            <i class="bi bi-lightning-charge-fill text-warning"></i> Holiday Deals 50% Off Limited Offer
            <i class="bi bi-lightning-charge-fill text-warning"></i>
        </marquee>
    </div>

    <!-- Main Container for two-column layout -->
    <div class="main-container">
        <!-- Sidebar for categories -->
        <aside class="sidebar">
            <div class="p-3 bg-white rounded shadow-sm">
                <label for="categorySelect" class="fw-bold mb-2">Select Category</label>
                <select id="categorySelect" class="form-select">
                    <option value="all">All</option>
                </select>
            </div>
        </aside>

        <!-- Main content for products -->
        <main class="content">
            <div class="row" id="productsContainer">
            </div>
        </main>
    </div>

    <!-- Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel">My Shopping Cart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="cartModalBody">
                    <!-- Cart items will be rendered as a table -->
                    <div id="cartEmptyMessage" class="text-center">
                        <p>Your cart is empty.</p>
                    </div>
                    <table id="cartTable" class="table" style="display: none;">
                        <thead>
                            <tr>
                                <th scope="col" class="product-info">Product</th>
                                <th scope="col">Price</th>
                                <th scope="col">Quantity</th>
                                <th scope="col">Total</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody id="cartTableBody">
                            <!-- Rows will be inserted here by JavaScript -->
                        </tbody>
                        <tfoot id="cartTableFooter" class="fw-bold">
                            <!-- Total will be inserted here -->
                        </tfoot>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Checkout</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // API Endpoints
        const categoryUrl = "https://fakestoreapi.com/products/categories";
        const productsUrl = "https://fakestoreapi.com/products";

        // DOM Element Selectors
        const categorySelect = document.getElementById("categorySelect");
        const productsContainer = document.getElementById("productsContainer");
        const cartBadge = document.getElementById("cartBadge");
        const navLinksContainer = document.getElementById("navLinksContainer");
        const cartTable = document.getElementById("cartTable");
        const cartTableBody = document.getElementById("cartTableBody");
        const cartTableFooter = document.getElementById("cartTableFooter");
        const cartEmptyMessage = document.getElementById("cartEmptyMessage");

        // Application state
        let cartItems = []; // Array to store products with quantity

        /**
         * Fetches categories and populates header navigation.
         */
        function loadNavLinks() {
            fetch(categoryUrl)
                .then(function(res) { return res.json(); })
                .then(function(categories) {
                    categories.forEach(function(category) {
                        const link = document.createElement("a");
                        link.href = "#";
                        link.textContent = category;
                        link.onclick = function() { loadProducts(category); };
                        navLinksContainer.appendChild(link);
                    });
                })
                .catch(function(error) { console.error("Error loading navigation links:", error); });
        }

        /**
         * Fetches categories and populates the sidebar dropdown.
         */
        function loadCategories() {
            fetch(categoryUrl)
                .then(function(res) { return res.json(); })
                .then(function(categories) {
                    categories.forEach(function(cat) {
                        const option = document.createElement("option");
                        option.value = cat;
                        option.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                        categorySelect.appendChild(option);
                    });
                })
                .catch(function(error) { console.error("Error loading categories:", error); });
        }

        /**
         * Fetches and displays products.
         * @param {string} [category="all"] - The category to filter by.
         */
        function loadProducts(category = "all") {
            productsContainer.innerHTML = `<div class="text-center w-100"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>`;
            const fetchUrl = (category === "all") ? productsUrl : `${productsUrl}/category/${encodeURIComponent(category)}`;
            
            fetch(fetchUrl)
                .then(function(res) { return res.json(); })
                .then(function(products) {
                    productsContainer.innerHTML = "";
                    products.forEach(function(product) {
                        const card = document.createElement("div");
                        card.className = "col-sm-6 col-md-4 col-lg-4 mb-4";
                        card.innerHTML = `
                        <div class="card h-100 shadow-sm">
                            <div class="d-flex align-items-center justify-content-center p-3" style="height: 220px;">
                                <img src="${product.image}" alt="${product.title}" class="card-img-top" style="max-height: 100%; max-width: 100%; object-fit: contain;" referrerpolicy="no-referrer">
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h6 class="card-title">${product.title}</h6>
                                <p class="card-text fw-bold mt-auto fs-5">$${product.price.toFixed(2)}</p>
                                <button class="btn btn-danger btn-sm add-to-cart-btn">Add to Cart</button>
                            </div>
                        </div>
                        `;
                        productsContainer.appendChild(card);
                        card.querySelector(".add-to-cart-btn").addEventListener("click", function() {
                            addToCart(product);
                        });
                    });
                })
                .catch(function(error) {
                    console.error("Error loading products:", error);
                    productsContainer.innerHTML = `<div class="alert alert-danger w-100">Failed to load products. Please try again later.</div>`;
                });
        }

        /**
         * Adds a product to the cart or increments its quantity if it already exists.
         * @param {object} product - The product to add.
         */
        function addToCart(product) {
            const existingItem = cartItems.find(function(item) {
                return item.id === product.id;
            });

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cartItems.push({ ...product, quantity: 1 });
            }
            updateCart();
        }

        /**
         * Changes the quantity of an item in the cart.
         * @param {number} productId - The ID of the product to modify.
         * @param {number} change - The amount to change the quantity by (e.g., 1 or -1).
         */
        function changeQuantity(productId, change) {
            const itemIndex = cartItems.findIndex(function(item) {
                return item.id === productId;
            });

            if (itemIndex > -1) {
                cartItems[itemIndex].quantity += change;
                if (cartItems[itemIndex].quantity <= 0) {
                    cartItems.splice(itemIndex, 1); // Remove if quantity is 0 or less
                }
            }
            updateCart();
        }
        
        /**
         * Removes an item from the cart entirely, regardless of quantity.
         * @param {number} productId - The ID of the product to remove.
         */
        function removeItemFromCart(productId) {
             const itemIndex = cartItems.findIndex(function(item) {
                return item.id === productId;
            });
            if(itemIndex > -1) {
                cartItems.splice(itemIndex, 1);
            }
            updateCart();
        }

        /**
         * Updates all cart-related UI elements.
         */
        function updateCart() {
            let totalItems = 0;
            cartItems.forEach(function(item) {
                totalItems += item.quantity;
            });
            cartBadge.textContent = totalItems;
            renderCartItems();
        }

        /**
         * Renders the cart items into the modal table.
         */
        function renderCartItems() {
            cartTableBody.innerHTML = "";
            cartTableFooter.innerHTML = "";

            if (cartItems.length === 0) {
                cartEmptyMessage.style.display = "block";
                cartTable.style.display = "none";
            } else {
                cartEmptyMessage.style.display = "none";
                cartTable.style.display = "table";
                let grandTotal = 0;

                cartItems.forEach(function(item) {
                    const row = cartTableBody.insertRow();
                    const itemTotal = item.price * item.quantity;
                    grandTotal += itemTotal;

                    row.innerHTML = `
                        <td class="product-info">
                            <div class="d-flex align-items-center">
                                <img src="${item.image}" alt="${item.title}" class="cart-item-img me-3" referrerpolicy="no-referrer">
                                <span class="fw-bold small">${item.title}</span>
                            </div>
                        </td>
                        <td>$${item.price.toFixed(2)}</td>
                        <td>
                            <div class="input-group input-group-sm justify-content-center">
                                <button class="btn btn-outline-secondary btn-minus">-</button>
                                <span class="input-group-text">${item.quantity}</span>
                                <button class="btn btn-outline-secondary btn-plus">+</button>
                            </div>
                        </td>
                        <td class="fw-bold">$${itemTotal.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-danger btn-sm btn-remove">
                                <i class="bi-trash"></i>
                            </button>
                        </td>
                    `;

                    // Add event listeners for quantity and remove buttons
                    row.querySelector(".btn-minus").addEventListener("click", function() { changeQuantity(item.id, -1); });
                    row.querySelector(".btn-plus").addEventListener("click", function() { changeQuantity(item.id, 1); });
                    row.querySelector(".btn-remove").addEventListener("click", function() { removeItemFromCart(item.id); });
                });
                
                // Add the grand total row to the footer
                cartTableFooter.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-end"><strong>Grand Total</strong></td>
                        <td colspan="2" class="text-start"><strong>$${grandTotal.toFixed(2)}</strong></td>
                    </tr>
                `;
            }
        }

        // Event listener for the category dropdown
        categorySelect.addEventListener("change", function() {
            loadProducts(this.value);
        });

        // Initial page load
        window.onload = function() {
            loadNavLinks();
            loadCategories();
            loadProducts();
            renderCartItems();
        };
    </script>

</body>

</html>
